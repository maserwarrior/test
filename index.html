<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (All-in-One)</title>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@1.5.10/css/pico.min.css">
    
    <style>
        /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° */
        body { padding: 20px; max-width: 1200px; margin: 0 auto; }
        
        /* Tab Navigation */
        .tab-nav { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .tab-btn { background: none; border: none; color: #666; cursor: pointer; font-size: 1.2rem; padding: 10px 20px; border-radius: 5px 5px 0 0; }
        .tab-btn:hover { background-color: #f0f0f0; }
        .tab-btn.active { background-color: #1095c1; color: white; font-weight: bold; }
        
        /* ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô Tab (‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô) */
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }

        /* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏•‡πâ‡∏≠‡∏á */
        .camera-box { position: relative; width: 640px; height: 480px; background: #000; margin: 0 auto; border-radius: 8px; overflow: hidden; }
        video { width: 100%; height: 100%; object-fit: cover; }
        canvas { position: absolute; top: 0; left: 0; }
        
        /* Dashboard Table */
        table { width: 100%; margin-top: 20px; }
        .status-success { color: green; font-weight: bold; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <nav>
        <ul>
            <li><strong>üè´ Face Attendance System</strong></li>
        </ul>
    </nav>

    <div class="tab-nav">
        <button class="tab-btn active" onclick="switchTab('scan')">üì∏ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ (Scan)</button>
        <button class="tab-btn" onclick="switchTab('register')">üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô (Register)</button>
        <button class="tab-btn" onclick="switchTab('dashboard')">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î (Dashboard)</button>
    </div>

    <div id="systemStatus" style="text-align:center; margin-bottom:10px; color:#e67e22;">
        ‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏°‡∏≠‡∏á AI... (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà)
    </div>

    <div id="scan" class="tab-content active">
        <article>
            <header>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</header>
            <div class="grid">
                <div>
                    <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                    <input type="text" id="scanClassId" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1-1" value="TestClass">
                    <button onclick="loadStudentsForScan()" id="btnLoadData">1. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                    <button onclick="startScanCamera()" id="btnStartScan" class="secondary" disabled>2. ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô</button>
                </div>
                <div>
                    <h6>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (Real-time)</h6>
                    <div id="scanLog" style="height:150px; overflow-y:auto; border:1px solid #ccc; padding:10px;">
                        <small>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠...</small>
                    </div>
                </div>
            </div>

            <div class="camera-box" id="scanContainer">
                <video id="scanVideo" autoplay muted></video>
            </div>
        </article>
    </div>

    <div id="register" class="tab-content">
        <article>
            <header>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</header>
            <div class="grid">
                <div>
                    <label>‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                    <input type="text" id="regClassId" placeholder="‡πÄ‡∏ä‡πà‡∏ô 1-1">
                    <label>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                    <input type="text" id="regStudentId">
                    <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="regName">
                    <button onclick="registerFace()" id="btnRegister" disabled>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</button>
                    <p id="regStatus"></p>
                </div>
                <div>
                    <div class="camera-box" id="regContainer" style="width:100%; height:350px;">
                        <video id="regVideo" autoplay muted></video>
                    </div>
                    <button class="outline" onclick="startRegisterCamera()" style="margin-top:10px;">‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
                </div>
            </div>
        </article>
    </div>

    <div id="dashboard" class="tab-content">
        <article>
            <header>‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</header>
            <div class="grid">
                <input type="text" id="dashClassId" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡πÄ‡∏ä‡πà‡∏ô 1-1)" value="TestClass">
                <button onclick="loadDashboard()">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
            
            <table role="grid">
                <thead>
                    <tr>
                        <th scope="col">‡∏£‡∏´‡∏±‡∏™</th>
                        <th scope="col">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                        <th scope="col">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤</th>
                    </tr>
                </thead>
                <tbody id="dashTableBody">
                    <tr><td colspan="3" style="text-align:center;">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á</td></tr>
                </tbody>
            </table>
        </article>
    </div>

    <script>
        // ‚ö†Ô∏è ‡πÉ‡∏™‡πà URL App Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby5Icavnzqn8PdDznQYGh5H93FgGbru21GKFDuJRyqJEy6sFHHzYnOMNqhsG96NY0B5kg/exec';
        
        // Model URL (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ./models ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)
        const MODEL_URL = 'https://justadudewhohacks.github.io/face-api.js/models';

        let modelsLoaded = false;
        let faceMatcher = null;
        let currentStream = null;
        let isProcessing = false;

        // --- 1. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ---
        window.onload = async () => {
            try {
                await Promise.all([
                    faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL),
                    faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),
                    faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)
                ]);
                modelsLoaded = true;
                document.getElementById('systemStatus').innerHTML = "‚úÖ AI ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß";
                document.getElementById('systemStatus').style.color = "green";
            } catch (err) {
                console.error(err);
                document.getElementById('systemStatus').innerHTML = "‚ùå ‡πÇ‡∏´‡∏•‡∏î AI ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏ô‡πá‡∏ï/Models)";
            }
        };

        // --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Tab ---
        function switchTab(tabName) {
            // ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏¢‡πà‡∏á‡∏Å‡∏±‡∏ô)
            stopCamera();

            // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡πÅ‡∏ó‡πá‡∏ö
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

            // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            document.getElementById(tabName).classList.add('active');
            // ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏õ‡∏∏‡πà‡∏°
            const btns = document.querySelectorAll('.tab-btn');
            if(tabName === 'scan') btns[0].classList.add('active');
            if(tabName === 'register') btns[1].classList.add('active');
            if(tabName === 'dashboard') btns[2].classList.add('active');
        }

        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ï‡∏±‡∏ß
            document.getElementById('scanVideo').srcObject = null;
            document.getElementById('regVideo').srcObject = null;
            // ‡∏•‡∏ö Canvas ‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏î‡∏ó‡∏±‡∏ö‡∏≠‡∏¢‡∏π‡πà
            document.querySelectorAll('canvas').forEach(c => c.remove());
        }

        // --- 3. Logic ‡∏™‡πà‡∏ß‡∏ô Register ---
        async function startRegisterCamera() {
            stopCamera(); // ‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô
            const video = document.getElementById('regVideo');
            const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
            currentStream = stream;
            video.srcObject = stream;
            
            document.getElementById('btnRegister').disabled = false;

            // ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤
            video.onplay = () => {
                const canvas = faceapi.createCanvasFromMedia(video);
                document.getElementById('regContainer').append(canvas);
                const displaySize = { width: video.offsetWidth, height: video.offsetHeight };
                faceapi.matchDimensions(canvas, displaySize);
                
                setInterval(async () => {
                    if(!modelsLoaded) return;
                    const detections = await faceapi.detectAllFaces(video).withFaceLandmarks();
                    const resized = faceapi.resizeResults(detections, displaySize);
                    canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);
                    faceapi.draw.drawDetections(canvas, resized);
                }, 100);
            };
        }

        async function registerFace() {
            if(!modelsLoaded) return;
            const btn = document.getElementById('btnRegister');
            const status = document.getElementById('regStatus');
            const video = document.getElementById('regVideo');

            btn.disabled = true;
            status.innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...";

            const detection = await faceapi.detectSingleFace(video).withFaceLandmarks().withFaceDescriptor();
            
            if(!detection) {
                status.innerHTML = "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤";
                btn.disabled = false;
                return;
            }

            const payload = {
                action: "register",
                classId: document.getElementById('regClassId').value,
                id: document.getElementById('regStudentId').value,
                prefix: "", 
                name: document.getElementById('regName').value,
                no: "",
                descriptors: JSON.stringify(Array.from(detection.descriptor))
            };

            fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) })
                .then(() => {
                    status.innerHTML = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
                    document.getElementById('regName').value = "";
                    document.getElementById('regStudentId').value = "";
                    setTimeout(() => { status.innerHTML = ""; btn.disabled = false; }, 2000);
                })
                .catch(err => {
                    status.innerHTML = "‚ùå Error: " + err;
                    btn.disabled = false;
                });
        }

        // --- 4. Logic ‡∏™‡πà‡∏ß‡∏ô Scan ---
        async function loadStudentsForScan() {
            const classId = document.getElementById('scanClassId').value;
            const btn = document.getElementById('btnLoadData');
            btn.textContent = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...";
            btn.disabled = true;

            try {
                const res = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: "getStudents", classId }) });
                const data = await res.json();
                
                if(data.students && data.students.length > 0) {
                    const labeledDescriptors = data.students.map(s => {
                        return new faceapi.LabeledFaceDescriptors(s.name, [new Float32Array(JSON.parse(s.descriptors))]);
                    });
                    faceMatcher = new faceapi.FaceMatcher(labeledDescriptors, 0.6);
                    alert(`‡πÇ‡∏´‡∏•‡∏î‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${data.students.length} ‡∏Ñ‡∏ô`);
                    document.getElementById('btnStartScan').disabled = false;
                } else {
                    alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");
                }
            } catch(e) {
                console.error(e);
                alert("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏•‡∏≤‡∏î");
            }
            btn.textContent = "1. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô";
            btn.disabled = false;
        }

        async function startScanCamera() {
            stopCamera();
            const video = document.getElementById('scanVideo');
            const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
            currentStream = stream;
            video.srcObject = stream;

            video.onplay = () => {
                const canvas = faceapi.createCanvasFromMedia(video);
                document.getElementById('scanContainer').append(canvas);
                const displaySize = { width: video.offsetWidth, height: video.offsetHeight };
                faceapi.matchDimensions(canvas, displaySize);

                setInterval(async () => {
                    if(!faceMatcher) return;
                    const detections = await faceapi.detectAllFaces(video).withFaceLandmarks().withFaceDescriptors();
                    const resized = faceapi.resizeResults(detections, displaySize);
                    canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);

                    const results = resized.map(d => faceMatcher.findBestMatch(d.descriptor));
                    results.forEach((result, i) => {
                        const box = resized[i].detection.box;
                        const { label } = result;
                        const drawBox = new faceapi.draw.DrawBox(box, { label });
                        drawBox.draw(canvas);

                        if(label !== "unknown" && !isProcessing) {
                            sendCheckIn(label, document.getElementById('scanClassId').value);
                        }
                    });
                }, 200);
            };
        }

        let checkedLog = new Set();
        function sendCheckIn(name, classId) {
            if(checkedLog.has(name)) return; // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ã‡πâ‡∏≥‡πÉ‡∏ô session ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡πà‡∏á
            isProcessing = true;
            
            // UI Update
            const logDiv = document.getElementById('scanLog');
            const time = new Date().toLocaleTimeString('th-TH');
            logDiv.innerHTML = `<div style="color:green">‚úÖ ${time} - ${name}</div>` + logDiv.innerHTML;
            checkedLog.add(name);

            // Send to Backend
            fetch(SCRIPT_URL, { 
                method: 'POST', 
                body: JSON.stringify({ action: "checkIn", classId: classId, id: name }) 
            }).then(() => {
                setTimeout(() => { isProcessing = false; }, 3000); // ‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ 3 ‡∏ß‡∏¥
            });
        }

        // --- 5. Logic ‡∏™‡πà‡∏ß‡∏ô Dashboard (Simple) ---
        async function loadDashboard() {
            const classId = document.getElementById('dashClassId').value;
            const tbody = document.getElementById('dashTableBody');
            tbody.innerHTML = '<tr><td colspan="3">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>';

            try {
                // ‡πÉ‡∏ä‡πâ Action ‡πÄ‡∏î‡∏¥‡∏° getStudents ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                const res = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: "getStudents", classId }) });
                const data = await res.json();
                
                tbody.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡πà‡∏≤
                if(data.students) {
                    data.students.forEach(s => {
                        const tr = `<tr>
                            <td>${s.id}</td>
                            <td>${s.name}</td>
                            <td class="status-success">‚úÖ ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß</td>
                        </tr>`;
                        tbody.innerHTML += tr;
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="3">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
                }
            } catch(e) {
                tbody.innerHTML = '<tr><td colspan="3" style="color:red">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</td></tr>';
            }
        }
    </script>
</body>
</html>
